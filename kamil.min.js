!function(e,t){var n={source:null,appendTo:null,disabled:!1,autoFocus:!1,minChars:1,noResultsMessage:null,property:null,exclude:"kamil-autocomplete-category",filter:function(e,t){return new RegExp(i.escapeRegex(t),"i").test(e)},sort:function(e,t){var n=this._opts.property,i=null===n?e.label||e.value||e:e[n],s=null===n?t.label||t.value||t:t[n];return i.length-s.length}},i={extend:function(e,t){var n,i={};for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&(i[n]=e[n]);for(n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n]);return i},escapeRegex:function(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")},getItemValue:function(e,t){var n=e._data[parseInt(t.getAttribute("data-position"))],i=e._opts.property;if(void 0!==n)return null===i?n.label||n.value||n:n[i]},trigger:function(e,n,i){var s=t.createEvent("HTMLEvents");for(var r in s.initEvent(n,!0,!0),i)s[r]=i[r];e.dispatchEvent(s)},isActive:function(e,t){var n=e.getElementsByTagName("li"),i=n.length;return"string"==typeof t&&(t="first"===t?0:i-1),n[t]?n[t].classList.contains("kamil-active"):null},noActive:function(e){return 0===e.getElementsByClassName("kamil-active").length},setActive:function(e){if(!e.item.classList.contains(this._opts.exclude)){var t=this._menu.getElementsByClassName("kamil-active");0!==t.length&&t[0].classList.remove("kamil-active"),e.item.classList.add("kamil-active"),e.fillSource&&(this._srcElement.value=i.getItemValue(this,e.item)),i.trigger(this._menu,"kamilfocus",{item:this._data[parseInt(e.item.getAttribute("data-position"))],inputElement:this._srcElement})}},move:function(e){if(this.open){if(1!==this._data.length||this._data[0]!==this._opts.noResultsMessage){var t=this._menu.getElementsByTagName("li");if("previous"===e&&i.isActive(this._menu,"first")||"next"===e&&i.isActive(this._menu,"last")||"previous"===e&&1===this._activeIndex&&t[0].classList.contains(this._opts.exclude)){this._srcElement.value=this.term,this._activeIndex=null;for(var n=0,s=t.length;n<s;n++)t[n].classList.contains("kamil-active")&&t[n].classList.remove("kamil-active")}else i.noActive(this._menu)||null===this._activeIndex?"previous"===e?this._activeIndex=t.length-1:"next"===e&&(this._activeIndex=0):this._activeIndex=this._activeIndex+("previous"===e?-1:1),t[this._activeIndex]&&t[this._activeIndex].classList.contains(this._opts.exclude)&&(this._activeIndex=this._activeIndex+("previous"===e?-1:1)),i.setActive.call(this,{item:t[this._activeIndex],fillSource:!0})}}else this.start(null)}},s={source:function(){var e=this._opts.source;if(e.constructor===Array)this.source=e;else{var n=t.querySelector(e).children;this.source=[];for(var i=0,s=n.length;i<s;i++){var r=n[i];this.source.push(r.textContent)}}},list:function(){var e=this._opts.appendTo;this._menu=t.createElement("ul"),this._menu.className="kamil-autocomplete",null!==e?t.querySelector(e).appendChild(this._menu):this._srcElement.parentNode.insertBefore(this._menu,this._srcElement.nextSibling)}},r={keyup:function(e){return function(t){if(!e._opts.disabled)switch(t.keyCode){case 38:i.move.call(e,"previous",t);break;case 40:i.move.call(e,"next",t);break;case 13:var n=e._menu.getElementsByClassName("kamil-active");if(0===n.length)return;var s=n[0];e._srcElement.value=i.getItemValue(e,s),i.trigger(e._menu,"kamilselect",{item:e._data[parseInt(s.getAttribute("data-position"))],inputElement:e._srcElement}),e.close();break;case 27:e._srcElement.value=e.term,e.close()}}},keydown:function(e){if(38===e.keyCode||40===e.keyCode)return e.preventDefault(),!1},input:function(){var e=this;return function(){e._opts.disabled||e.term===e._srcElement.value&&e.open||(e._activeIndex=null,e.start(null))}},itemClickFlag:!0,mousedown:function(){r.itemClickFlag=!1},mouseup:function(e){return function(){r.itemClickFlag=!0,e._srcElement.value=i.getItemValue(e,this),i.trigger(e._menu,"kamilselect",{item:e._data[parseInt(this.getAttribute("data-position"))],inputElement:e._srcElement}),e._srcElement.focus(),e.close()}},mouseover:function(e){return function(){i.setActive.call(e,{item:this,fillSource:!1})}},mouseout:function(e){return function(){var t=e._menu.getElementsByClassName("kamil-active")[0];t&&t.classList.remove("kamil-active")}},blur:function(e){return function(){!e._opts.disabled&&r.itemClickFlag&&e.close()}}},l=e.Kamil=function(e,l){var o=this;o._opts=i.extend(n,l),o._activeIndex=null,o._data=null,o.open=!1;var a=o._srcElement="string"==typeof e?t.querySelector(e):e;a.addEventListener("input",r.input.call(o),!1),a.addEventListener("keyup",r.keyup(o),!1),a.addEventListener("keydown",r.keydown,!1),a.addEventListener("blur",r.blur(o),!1),s.source.call(o),s.list.call(o)};l.prototype._resizeMenu=function(){var e=this._menu.style;e.width=this._srcElement.offsetWidth+"px",e.left=this._srcElement.offsetLeft+"px",e.top=this._srcElement.offsetTop+this._srcElement.offsetHeight+"px"},l.prototype._renderItemData=function(e,t,n){var i=this.renderItem(e,t);return i.setAttribute("data-position",n),i.addEventListener("mousedown",r.mousedown,!1),i.addEventListener("mouseup",r.mouseup(this),!1),i.addEventListener("mouseover",r.mouseover(this),!1),i.addEventListener("mouseout",r.mouseout(this),!1),i},l.prototype._renderMenu=function(e,t){for(var n=this._menu;n.firstChild;)n.removeChild(n.firstChild);this._resizeMenu(),this.renderMenu(n,e),0!==n.children.length?("block"!==n.style.display&&(n.style.display="block"),t()):n.style.display="none"},l.prototype.renderItem=function(e,n){var i=t.createElement("li");return i.innerHTML=null===this._opts.property?n.label||n.value||n:n[this._opts.property],e.appendChild(i),i},l.prototype.renderMenu=function(e,t){for(var n=0,i=t.length;n<i;n++){var s=t[n];this._renderItemData(e,s,n)}},l.prototype.start=function(e){var t=this;e=null!==e?e:t._srcElement.value,t.term=t._srcElement.value,t._opts.disabled||(e?e.length<t._opts.minChars?t.close():(t._data=t.source.filter(function(n){return t._opts.filter(null===t._opts.property?n.label||n.value||n:n[t._opts.property],e)}).sort(function(e,n){return t._opts.sort.call(t,e,n)}),0===t._data.length&&null!==t._opts.noResultsMessage&&(t._data=[t._opts.noResultsMessage]),i.trigger(this._menu,"kamilresponse",{content:t._data,inputElement:t._srcElement}),t._renderMenu(t._data,function(){if(t._opts.autoFocus){var e=t._menu.getElementsByTagName("li");i.setActive.call(t,{item:e[0],fillSource:!1})}t.open=!0,i.trigger(t._menu,"kamilopen")})):t.close())},l.prototype.close=function(){this.open&&(this._menu.style.display="none",this.open=!1,i.trigger(this._menu,"kamilclose"))},l.prototype.destroy=function(){this._menu.remove();var e=this._srcElement;e.removeEventListener("input",r.input.call(this),!1),e.removeEventListener("keyup",r.keyup(this),!1),e.removeEventListener("keydown",r.keydown,!1),e.removeEventListener("blur",r.blur(this),!1)},l.prototype.disable=function(){this.close(),this._opts.disabled=!0},l.prototype.enable=function(){this._opts.disabled=!1},l.prototype.isEnabled=function(){return!this._opts.disabled},l.prototype.option=function(){switch(arguments.length){case 0:return this._opts;case 1:return this._opts[arguments[0]];case 2:this._opts[arguments[0]]=arguments[1]}},l.prototype.on=function(e,t){var n=this;n._menu.addEventListener(e,function(i){"kamilresponse"===e?n._data=t(i):t(i)},!1)}}(window,document);
